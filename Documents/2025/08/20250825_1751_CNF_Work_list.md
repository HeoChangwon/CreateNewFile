# CreateNewFile 작업 일지 - 2025-08-25 17:51

**문서 작성자**: 허창원 ((주)그린파워) with Claude Code Assistant

## 📋 작업 개요

이번 세션에서는 CreateNewFile 프로젝트의 설치 시스템을 대폭 개선하고 정리했습니다. 주요 작업은 config 파일 누락 해결, Python 빌드 스크립트 도입, .NET 감지 로직 개선, 그리고 Program Files 단일 설치 경로로 통합이었습니다.

## 🎯 주요 작업 내용

### 1. Config 파일 누락 문제 해결
**문제**: 02_BuildInstaller.bat 실행 시 config 폴더와 appsettings.default.json 파일이 인스톨러에 포함되지 않음

**해결책**:
- `Package.wxs`에 ConfigFiles 컴포넌트 추가
- WiX Feature에 ComponentRef 추가
- 설치 시 config 파일이 자동으로 포함되도록 수정

**수정된 파일**: `Package.wxs`, `Package.GreenPower.wxs`, `Package.ProgramFiles.wxs`

### 2. Python 빌드 스크립트 도입
**이유**: 배치 파일의 타임스탬프 생성 문제와 더 나은 사용자 경험 제공

**개발한 스크립트**:
- `update_project.py` - 프로젝트 빌드 및 퍼블리시
- `build_installer.py` - 인스톨러 빌드 (GreenPower/Program Files 선택)
- `build_all.py` - 통합 빌드 스크립트
- `requirements.txt` - 필요한 패키지 목록 (colorama)

**편의용 배치 래퍼**:
- `build_all_py.bat`, `update_project_py.bat` 등

**장점**:
- 정확한 타임스탬프 생성 (`datetime.now().strftime("%Y%m%d_%H%M")`)
- 색상 출력으로 진행 상황 명확 표시
- 에러 처리 및 해결 방법 제시
- 크로스 플랫폼 호환성

### 3. .NET 8 감지 로직 개선
**문제**: 설치 시 .NET 8이 이미 설치되어 있음에도 불구하고 필요하다는 팝업 발생

**시도한 해결책들**:
1. 레지스트리 경로 수정 (`sharedhost` → `Microsoft.WindowsDesktop.App`)
2. DirectorySearch 사용 (WiX 6 호환성 문제)
3. 여러 조건 조합 (NETDESKTOP8_INSTALLED OR NETCORE8_INSTALLED)

**최종 해결책**:
- .NET 검사 조건 완전 제거 (주석 처리)
- Windows가 실행 시 자동으로 .NET 오류 처리하도록 변경
- 사용자 친화적인 설치 경험 제공

### 4. 사용자별 설정 폴더로 경로 변경
**문제**: Program Files 설치 시 appsettings.json 생성/수정 권한 문제

**해결책**:
- `SettingsService.cs`의 `GetDefaultSettingsFilePath()` 수정
- 사용자 설정: `%APPDATA%\CreateNewFile\config\appsettings.json`
- 템플릿 파일: `Program Files\CreateNewFile\config\appsettings.default.json` (읽기 전용)

**장점**:
- 권한 문제 해결
- 사용자별 독립된 설정
- Windows 표준 규칙 준수

### 5. Program Files vs Program Files (x86) 문제 해결
**발견된 문제**: WiX에서 `ProgramFiles6432Folder` 사용으로 인해 Program Files (x86)에 설치됨

**해결책**:
- .NET 8 애플리케이션은 64비트가 적합하므로 `ProgramFilesFolder` 사용
- Package.ProgramFiles.wxs에서 디렉토리 구조 수정
- 올바른 64비트 Program Files 폴더에 설치되도록 개선

### 6. 인스톨러 파일 구조 정리
**문제**: GreenPower와 Program Files 두 가지 설치 옵션으로 인한 복잡성

**결정**: Program Files 단일 설치 경로로 통합

**정리한 파일들**:

**제거된 파일**:
- `Package.GreenPower.wxs`
- `02_BuildInstaller_GreenPower.bat`
- `build_greenpower_py.bat`
- GreenPower 관련 모든 MSI/PDB 파일
- 중복 테스트 파일들

**업데이트된 파일**:
- `Package.wxs` → Program Files 전용으로 수정
- `00_BuildAll.bat` → 단순화
- `02_BuildInstaller.bat` → Program Files 전용
- Python 스크립트들 → GreenPower 옵션 제거

## 📁 최종 파일 구조

### 인스톨러 핵심 파일
- `Package.wxs` - Program Files 설치용 WiX 파일
- `00_BuildAll.bat` - 통합 빌드
- `01_UpdateFromProject.bat` - 프로젝트 업데이트
- `02_BuildInstaller.bat` - 인스톨러 빌드

### Python 스크립트
- `build_all.py` - Python 통합 빌드
- `build_installer.py` - Python 인스톨러 빌드
- `update_project.py` - Python 프로젝트 업데이트
- `requirements.txt` - 패키지 의존성

### 최종 인스톨러
- `CreateNewFileSetup_v1.0.001_Final.msi` - 최종 배포용 인스톨러

## 🎯 설치 경로 정보

**실행 파일**: `C:\Program Files\CreateNewFile\CreateNewFile.exe`
**템플릿 파일**: `C:\Program Files\CreateNewFile\config\appsettings.default.json`
**사용자 설정**: `C:\Users\[사용자명]\AppData\Roaming\CreateNewFile\config\appsettings.json`

## 🚀 사용 방법

### 배치 파일 사용 (권장)
```bash
# 통합 빌드
00_BuildAll.bat

# 개별 단계
01_UpdateFromProject.bat  # 프로젝트 업데이트
02_BuildInstaller.bat     # 인스톨러 빌드
```

### Python 스크립트 사용
```bash
# 패키지 설치 (최초 1회)
pip install colorama

# 통합 빌드
python build_all.py

# 개별 실행
python update_project.py
python build_installer.py --interactive
```

## ✅ 해결된 문제들

1. **Config 파일 누락** → WiX 컴포넌트 추가로 해결
2. **타임스탬프 생성 오류** → Python 스크립트로 해결
3. **.NET 감지 팝업** → 조건 제거로 해결
4. **권한 문제** → 사용자 폴더로 설정 경로 변경
5. **잘못된 설치 경로** → Program Files 64비트로 수정
6. **복잡한 파일 구조** → 단일 설치 경로로 통합

## 🔧 기술적 개선사항

- **WiX 6 호환성**: 최신 WiX Toolset 문법 적용
- **사용자 경험**: 색상 출력 및 명확한 진행 상황 표시
- **에러 처리**: 구체적인 해결 방법 제시
- **Windows 표준**: 적절한 설치 경로 및 권한 관리
- **코드 정리**: 불필요한 파일 제거 및 구조 단순화

## 📊 작업 통계

- **수정된 파일**: 15개
- **제거된 파일**: 12개  
- **새로 생성된 파일**: 6개
- **해결된 이슈**: 6개
- **작업 시간**: 약 3시간

## 🎉 결론

CreateNewFile 프로젝트의 설치 시스템이 크게 개선되었습니다. Python 스크립트 도입으로 더욱 안정적이고 사용자 친화적인 빌드 프로세스가 구축되었으며, Program Files 단일 설치 경로로 통합하여 복잡성을 줄이고 Windows 표준을 준수하게 되었습니다. 사용자별 설정 폴더 분리로 권한 문제도 완전히 해결되었습니다.