# CreateNewFile (CNF) - 설계 문서

**문서 작성자**: 허창원 (changwon.heo@gmail.com) with Claude Code Assistant

## 1. 시스템 아키텍처

### 1.1 전체 아키텍처
```
┌─────────────────────────────────────────┐
│              Presentation Layer         │
│  ┌─────────────┐  ┌──────────────────┐  │
│  │ MainWindow  │  │ SettingsWindow   │  │
│  │   (XAML)    │  │     (XAML)       │  │
│  └─────────────┘  └──────────────────┘  │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│             Business Layer              │
│  ┌─────────────┐  ┌──────────────────┐  │
│  │FileGenerator│  │SettingsManager   │  │
│  │   Service   │  │    Service       │  │
│  └─────────────┘  └──────────────────┘  │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│              Data Layer                 │
│  ┌─────────────┐  ┌──────────────────┐  │
│  │ File System │  │   JSON Config    │  │
│  │             │  │     Storage      │  │
│  └─────────────┘  └──────────────────┘  │
└─────────────────────────────────────────┘
```

### 1.2 기술 스택
- **UI Framework**: WPF (.NET 8.0)
- **아키텍처 패턴**: MVVM (Model-View-ViewModel)
- **데이터 저장**: JSON 파일
- **의존성 주입**: Microsoft.Extensions.DependencyInjection

## 2. 프로젝트 구조

```
CreateNewFile/
├── CreateNewFile/
│   ├── src/
│   │   └── CreateNewFile/
│   │       ├── CreateNewFile.csproj
│   │       ├── App.xaml
│   │       ├── App.xaml.cs
│   │       ├── Views/
│   │       │   ├── MainWindow.xaml
│   │       │   ├── MainWindow.xaml.cs
│   │       │   ├── SettingsWindow.xaml
│   │       │   └── SettingsWindow.xaml.cs
│   │       ├── ViewModels/
│   │       │   ├── MainViewModel.cs
│   │       │   ├── SettingsViewModel.cs
│   │       │   └── BaseViewModel.cs
│   │       ├── Models/
│   │       │   ├── FileCreationRequest.cs
│   │       │   ├── AppSettings.cs
│   │       │   └── PresetItem.cs
│   │       ├── Services/
│   │       │   ├── IFileGeneratorService.cs
│   │       │   ├── FileGeneratorService.cs
│   │       │   ├── ISettingsService.cs
│   │       │   └── SettingsService.cs
│   │       ├── Utils/
│   │       │   ├── FileNameBuilder.cs
│   │       │   └── ValidationHelper.cs
│   │       └── Resources/
│   │           ├── Styles.xaml
│   │           └── Icons/
│   └── config/
│       └── appsettings.json
└── Documents/
    ├── Requirements.md
    ├── Design.md
    └── Task_list.md
```

## 3. 데이터 모델 설계

### 3.1 핵심 모델

#### FileCreationRequest
```csharp
public class FileCreationRequest
{
    public DateTime DateTime { get; set; }
    public string Abbreviation { get; set; }
    public string Title { get; set; }
    public string Suffix { get; set; }
    public string Extension { get; set; }
    public string OutputPath { get; set; }
    public string TemplatePath { get; set; }
}
```

#### AppSettings
```csharp
public class AppSettings
{
    public string DefaultOutputPath { get; set; }
    public string DefaultTemplatePath { get; set; }
    public List<PresetItem> Abbreviations { get; set; }
    public List<PresetItem> Titles { get; set; }
    public List<PresetItem> Suffixes { get; set; }
    public List<PresetItem> Extensions { get; set; }
    public List<PresetItem> OutputPaths { get; set; }
    public List<PresetItem> TemplatePaths { get; set; }
}
```

#### PresetItem
```csharp
public class PresetItem
{
    public string Id { get; set; }
    public string Value { get; set; }
    public string Description { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime LastUsed { get; set; }
    public int UsageCount { get; set; }
}
```

### 3.2 ViewModel 설계

#### MainViewModel
```csharp
public class MainViewModel : BaseViewModel
{
    // Properties
    public DateTime SelectedDateTime { get; set; }
    public string SelectedAbbreviation { get; set; }
    public string SelectedTitle { get; set; }
    public string SelectedSuffix { get; set; }
    public string SelectedExtension { get; set; }
    public string SelectedOutputPath { get; set; }
    public string SelectedTemplatePath { get; set; }
    public string GeneratedFileName { get; set; }
    public string FullFilePath { get; set; }
    
    // Collections
    public ObservableCollection<PresetItem> Abbreviations { get; set; }
    public ObservableCollection<PresetItem> Titles { get; set; }
    public ObservableCollection<PresetItem> Suffixes { get; set; }
    public ObservableCollection<PresetItem> Extensions { get; set; }
    public ObservableCollection<PresetItem> OutputPaths { get; set; }
    public ObservableCollection<PresetItem> TemplatePaths { get; set; }
    
    // Commands
    public ICommand SetCurrentDateTimeCommand { get; set; }
    public ICommand CreateFileCommand { get; set; }
    public ICommand OpenSettingsCommand { get; set; }
    public ICommand BrowseOutputPathCommand { get; set; }
    public ICommand BrowseTemplatePathCommand { get; set; }
}
```

## 4. 서비스 레이어 설계

### 4.1 FileGeneratorService
```csharp
public interface IFileGeneratorService
{
    string GenerateFileName(FileCreationRequest request);
    Task<bool> CreateFileAsync(FileCreationRequest request);
    bool ValidateRequest(FileCreationRequest request);
    string GetFullFilePath(FileCreationRequest request);
}

public class FileGeneratorService : IFileGeneratorService
{
    // 파일명 생성 로직
    // 파일 생성 로직
    // 템플릿 복사 로직
    // 유효성 검사 로직
}
```

### 4.2 SettingsService
```csharp
public interface ISettingsService
{
    Task<AppSettings> LoadSettingsAsync();
    Task SaveSettingsAsync(AppSettings settings);
    Task<List<PresetItem>> GetPresetItemsAsync(PresetType type);
    Task AddPresetItemAsync(PresetType type, PresetItem item);
    Task UpdatePresetItemAsync(PresetType type, PresetItem item);
    Task DeletePresetItemAsync(PresetType type, string itemId);
}

public enum PresetType
{
    Abbreviation,
    Title,
    Suffix,
    Extension,
    OutputPath,
    TemplatePath
}
```

## 5. UI/UX 설계

### 5.1 메인 윈도우 레이아웃
```
┌─────────────────────────────────────────────────────────┐
│ CreateNewFile - 파일 생성기                              │
├─────────────────────────────────────────────────────────┤
│ 날짜/시간: [2025-08-22 09:44] [현재시간]                │
│ 약어:     [CNF ▼] ________________________               │
│ 제목:     [Development_note_with_AI ▼] ______________    │
│ 접미어:   [v1.0 ▼] _______________________              │
│ 확장자:   [.txt ▼] _______________________              │
│                                                         │
│ 출력폴더: [D:\Work_Claude\CreateNewFile\Documents ▼]    │
│          [📁 찾아보기] [드래그앤드롭 영역]               │
│                                                         │
│ 템플릿:   [C:\Templates\default.txt ▼]                  │
│          [📁 찾아보기] [드래그앤드롭 영역]               │
│                                                         │
│ ─────────────────────────────────────────────────────── │
│ 생성될 파일명:                                          │
│ 20250822_0944_CNF_Development_note_with_AI.txt         │
│                                                         │
│ 전체 경로:                                              │
│ D:\Work_Claude\CreateNewFile\Documents\20250822_0944_  │
│ CNF_Development_note_with_AI.txt                       │
│ ─────────────────────────────────────────────────────── │
│              [파일 생성] [설정 관리]                     │
└─────────────────────────────────────────────────────────┘
```

### 5.2 설정 관리 윈도우
```
┌─────────────────────────────────────────────────────────┐
│ 설정 관리                                               │
├─────────────────────────────────────────────────────────┤
│ [약어] [제목] [접미어] [확장자] [출력폴더] [템플릿]      │
│                                                         │
│ ┌─ 약어 목록 ──────────────────────────────────────────┐ │
│ │ ☑ CNF     - CreateNewFile                           │ │
│ │ ☑ DOC     - Document                                │ │
│ │ ☑ LOG     - Log File                                │ │
│ │ ☑ TEST    - Test File                               │ │
│ │                                                     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 새 항목 추가: [________] [추가]                         │
│                                                         │
│ 선택된 항목: CNF - CreateNewFile                        │
│ 값:   [CNF_____________]                                │
│ 설명: [CreateNewFile___]                                │
│       [수정] [삭제]                                     │
│                                                         │
│                              [확인] [취소]              │
└─────────────────────────────────────────────────────────┘
```

## 6. 파일명 생성 알고리즘

### 6.1 파일명 구성 규칙
```csharp
public string GenerateFileName(FileCreationRequest request)
{
    var components = new List<string>();
    
    // 1. 날짜/시간 (YYYYMMDD_HHMM)
    var dateTimeStr = request.DateTime.ToString("yyyyMMdd_HHmm");
    components.Add(dateTimeStr);
    
    // 2. 약어
    if (!string.IsNullOrWhiteSpace(request.Abbreviation))
        components.Add(request.Abbreviation.Trim());
    
    // 3. 제목
    if (!string.IsNullOrWhiteSpace(request.Title))
        components.Add(request.Title.Trim().Replace(" ", "_"));
    
    // 4. 접미어 (선택사항)
    if (!string.IsNullOrWhiteSpace(request.Suffix))
        components.Add(request.Suffix.Trim());
    
    // 언더스코어로 연결
    var fileName = string.Join("_", components);
    
    // 5. 확장자 추가
    if (!string.IsNullOrWhiteSpace(request.Extension))
    {
        var extension = request.Extension.StartsWith(".") 
            ? request.Extension 
            : "." + request.Extension;
        fileName += extension;
    }
    
    return fileName;
}
```

### 6.2 파일 생성 로직
```csharp
public async Task<bool> CreateFileAsync(FileCreationRequest request)
{
    try
    {
        var fileName = GenerateFileName(request);
        var fullPath = Path.Combine(request.OutputPath, fileName);
        
        // 파일 존재 확인
        if (File.Exists(fullPath))
        {
            throw new InvalidOperationException($"파일이 이미 존재합니다: {fileName}");
        }
        
        // 템플릿 파일 처리
        if (!string.IsNullOrWhiteSpace(request.TemplatePath) && 
            File.Exists(request.TemplatePath))
        {
            await File.CopyAsync(request.TemplatePath, fullPath);
        }
        else
        {
            // 빈 파일 생성 (txt의 경우 공백 문자 추가)
            var content = request.Extension.ToLower() == ".txt" ? " " : string.Empty;
            await File.WriteAllTextAsync(fullPath, content);
        }
        
        return true;
    }
    catch (Exception ex)
    {
        // 로깅 및 에러 처리
        return false;
    }
}
```

## 7. 데이터 저장 형식

### 7.1 설정 파일 (appsettings.json)
```json
{
  "DefaultSettings": {
    "OutputPath": "D:\\Work_Claude\\CreateNewFile\\Documents",
    "TemplatePath": ""
  },
  "PresetItems": {
    "Abbreviations": [
      {
        "Id": "cnf-001",
        "Value": "CNF",
        "Description": "CreateNewFile",
        "CreatedAt": "2025-08-22T09:44:00",
        "LastUsed": "2025-08-22T09:44:00",
        "UsageCount": 5
      }
    ],
    "Titles": [
      {
        "Id": "title-001",
        "Value": "Development_note_with_AI",
        "Description": "AI 개발 노트",
        "CreatedAt": "2025-08-22T09:44:00",
        "LastUsed": "2025-08-22T09:44:00",
        "UsageCount": 3
      }
    ]
  }
}
```

## 8. 보안 및 검증

### 8.1 입력 검증
- 파일명에 사용할 수 없는 문자 필터링: `< > : " | ? * / \`
- 경로 길이 제한 (Windows: 260자)
- 확장자 화이트리스트 검증

### 8.2 파일 시스템 보안
- 상위 디렉토리 접근 방지 (../ 패턴)
- 시스템 폴더 접근 제한
- 쓰기 권한 확인

## 9. 확장성 고려사항

### 9.1 플러그인 아키텍처
- 파일명 생성 규칙 커스터마이징
- 추가 템플릿 형식 지원
- 외부 도구 연동

### 9.2 다국어 지원
- 리소스 파일 기반 다국어
- 날짜/시간 형식 지역화

### 9.3 클라우드 연동
- 클라우드 스토리지 지원
- 설정 동기화