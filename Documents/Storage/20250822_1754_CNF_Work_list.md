# CreateNewFile 프로그램 Work List
**작성일시**: 2025년 8월 22일 17:54  
**약어**: CNF  
**제목**: Work_list  

---

## 작업 개요
프로그램 내의 각 항목(일시, 약어, 제목, 접미어, 확장자, 출력폴더, 템플릿 파일)이 마지막 설정된 정보를 프로그램 종료 후 다시 실행될 때 그대로 Load되도록 하는 기능 구현 및 날짜/시간 유지 기능 추가.

---

## 주요 작업 항목

### 1. 설정 저장/로드 시스템 구현
- **상태**: ✅ 완료 (기존 구현 확인)
- **내용**: 
  - ISettingsService 인터페이스가 이미 완전히 구현되어 있었음
  - SettingsService 클래스가 JSON 기반으로 완전히 구현되어 있었음
  - 설정 파일 경로: `config/appsettings.json`

### 2. AppSettings 모델 확장
- **상태**: ✅ 완료
- **내용**: 마지막 선택된 항목들을 저장하기 위한 속성 추가
  ```csharp
  public string LastSelectedAbbreviation { get; set; } = string.Empty;
  public string LastSelectedTitle { get; set; } = string.Empty;
  public string LastSelectedSuffix { get; set; } = string.Empty;
  public string LastSelectedExtension { get; set; } = string.Empty;
  public string LastSelectedOutputPath { get; set; } = string.Empty;
  public string LastSelectedTemplatePath { get; set; } = string.Empty;
  public DateTime LastSelectedDateTime { get; set; } = DateTime.Now;
  ```
- **파일**: `Models/AppSettings.cs:60-93, 206-217`

### 3. MainViewModel 설정 로드 로직 수정
- **상태**: ✅ 완료
- **내용**: 
  - `SetDefaultValues()` 메서드 수정하여 마지막 설정 정보를 우선 로드
  - 날짜/시간 초기화 로직 변경 (생성자에서 DateTime.Now 제거)
  - 우선순위: 마지막 설정 → 기본 설정 → 첫 번째 항목
- **파일**: `ViewModels/MainViewModel.cs:276-277, 389-439`

### 4. 설정 자동 저장 기능 구현
- **상태**: ✅ 완료
- **내용**:
  - `SaveLastSelectedItemsAsync()` 메서드 추가
  - 파일 생성 완료 후 자동으로 현재 선택 상태 저장
  - `SaveCurrentStateAsync()` 공개 메서드 추가 (애플리케이션 종료 시 사용)
- **파일**: `ViewModels/MainViewModel.cs:827-855`

### 5. 애플리케이션 수명 주기 관리
- **상태**: ✅ 완료
- **내용**:
  - **시작 시**: 기존 `LoadDataAsync()`에서 자동으로 마지막 설정 로드
  - **종료 시**: `App.xaml.cs`의 `OnExit()`에서 현재 설정 자동 저장 (최대 5초 대기)
- **파일**: `App.xaml.cs:54-83`

### 6. 날짜/시간 유지 기능 추가
- **상태**: ✅ 완료
- **내용**:
  - 프로그램 새로 시작 시 날짜/시간 정보도 그대로 유지
  - "현재 일시" 버튼을 누를 때에만 현재 일시 적용
  - 버튼 텍스트를 "현재시간"에서 "현재 일시"로 변경
- **파일**: `Views/MainWindow.xaml:149`

---

## 기술적 구현 세부사항

### 설정 저장 우선순위
1. **마지막 선택된 값** (LastSelected*)
2. **기본 설정값** (Default*)  
3. **첫 번째 프리셋 항목**

### 자동 저장 시점
- 파일 생성 완료 후 (`UpdateUsageStatistics()` 메서드에서)
- 애플리케이션 종료 시 (`App.OnExit()` 메서드에서)

### 설정 파일 구조
```json
{
  "LastSelectedDateTime": "2025-08-22T17:54:00",
  "LastSelectedAbbreviation": "CNF",
  "LastSelectedTitle": "Work_list",
  "LastSelectedSuffix": "",
  "LastSelectedExtension": ".md",
  "LastSelectedOutputPath": "D:\\Work_Claude\\CreateNewFile\\Documents",
  "LastSelectedTemplatePath": "",
  // ... 기타 설정들
}
```

---

## 검증 및 테스트

### 빌드 결과
- **상태**: ✅ 성공
- **경고**: 10개 (기존 nullable 관련 경고, 기능에 영향 없음)
- **오류**: 0개

### 기능 검증 항목
- [x] 프로그램 시작 시 마지막 설정 정보 자동 로드
- [x] 날짜/시간 정보 유지 (현재 일시 버튼 클릭 시에만 업데이트)
- [x] 파일 생성 후 설정 자동 저장
- [x] 프로그램 종료 시 설정 자동 저장
- [x] UI 텍스트 변경 ("현재 일시" 버튼)

---

## 파일 변경 사항

### 수정된 파일
1. **Models/AppSettings.cs**
   - 마지막 선택 항목 속성 추가
   - Clone() 메서드에 새 속성 포함

2. **ViewModels/MainViewModel.cs**
   - 생성자에서 날짜/시간 초기화 제거
   - SetDefaultValues() 메서드 수정
   - SaveLastSelectedItemsAsync() 메서드 추가
   - SaveCurrentStateAsync() 공개 메서드 추가

3. **App.xaml.cs**
   - OnExit() 메서드에 설정 자동 저장 기능 추가

4. **Views/MainWindow.xaml**
   - "현재시간" 버튼 텍스트를 "현재 일시"로 변경

---

## 사용자 경험 개선사항
- 프로그램 재시작 시 이전 작업 상태가 그대로 유지됨
- 날짜/시간이 의도치 않게 변경되지 않음
- 명시적인 "현재 일시" 버튼 클릭을 통해서만 시간 업데이트
- 설정 저장/로드가 자동화되어 사용자 편의성 향상

---

## 향후 개선 가능 항목
- 설정 파일 암호화 고려
- 설정 백업/복원 기능 활용
- 사용자별 설정 프로필 관리
- 설정 변경 히스토리 관리

---

**작업 완료일**: 2025년 8월 22일 17:54  
**다음 작업 예정**: 사용자 피드백을 통한 추가 기능 개선