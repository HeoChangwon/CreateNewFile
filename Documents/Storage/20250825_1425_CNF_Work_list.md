# CreateNewFile 작업 내역 - 2025년 8월 25일 (14:25)

**문서 작성자**: 허창원 ((주)그린파워) with Claude Code Assistant

## 📋 개요

이번 세션에서는 CreateNewFile 프로젝트의 WiX 기반 설치 관리자 구현 및 Visual Studio 호환성 문제를 해결했습니다.

---

## 🎯 주요 작업 내용

### 1. WiX Toolset v6 설치 및 설정 ✅

**작업 내용:**
- WiX Toolset v6.0.1을 .NET 도구로 설치
- 명령: `dotnet tool install --global wix`
- 버전 확인 및 정상 작동 검증

**결과:**
```
wix --version
6.0.1+b05d563
```

### 2. WiX 설치 관리자 프로젝트 생성 ✅

**생성된 파일들:**
- `CreateNewFile.Installer.wixproj`: WiX 프로젝트 파일
- `Package.wxs`: 메인 설치 패키지 정의
- `1042.wxl`: 한국어 리소스 파일
- `license.rtf`: 라이선스 파일

**주요 설정:**
- **설치 경로**: `C:\GreenPower\CreateNewFile`
- **플랫폼**: x64
- **Framework-dependent 배포**: .NET 8 Desktop Runtime 필요
- **파일 크기**: 약 2.65MB

### 3. .NET 8 런타임 자동 체크 기능 구현 ✅

**구현 내용:**
- 레지스트리 기반 .NET 8 설치 여부 확인
- 미설치 시 사용자 친화적 설치 가이드 표시
- 다운로드 링크 제공: `https://dotnet.microsoft.com/ko-kr/download/dotnet/8.0`
- 브라우저 실행 실패 시 클립보드 복사 대안

**핵심 코드 위치:**
- `App.xaml.cs:24-30`: 애플리케이션 시작 시 런타임 체크
- `Utils/RuntimeChecker.cs`: 런타임 검증 및 설치 가이드 로직

### 4. Visual Studio 호환성 문제 해결 ✅

**문제:**
- WiX 프로젝트가 솔루션에 포함되어 로딩 실패
- "일부 중요한 가져오기가 없거나 참조된 SDK를 찾을 수 없음" 오류

**해결 방법:**
- `CreateNewFile.sln`에서 WiX 프로젝트 제거
- WiX 프로젝트를 별도 관리하여 호환성 문제 해결
- Visual Studio는 메인 애플리케이션 개발용으로 전용화

**결과:**
- ✅ Visual Studio에서 정상 로딩 및 개발 가능
- ✅ F5 디버깅, 빌드, 테스트 모든 기능 정상 작동

### 5. 자동화된 빌드 스크립트 개발 ✅

**생성된 배치 파일들:**

#### **`00_BuildAll.bat`** - 전체 자동 빌드
- CreateNewFile 프로젝트 업데이트부터 MSI 생성까지 전체 과정 자동화
- 매개변수 기반 모드 분리로 중복 실행 방지

#### **`01_UpdateFromProject.bat`** - 프로젝트 업데이트
- CreateNewFile Release 빌드
- Framework-dependent 게시 (`bin\Release\Publish`)
- 게시된 파일 검증

#### **`02_BuildInstaller.bat`** - MSI 생성
- WiX 도구 설치 확인
- WiX MSI 빌드 실행
- 빌드 결과 검증 및 정보 표시

**주요 특징:**
- 상세한 진행 상황 표시
- 포괄적인 오류 처리 및 해결 가이드
- 색상 구분 및 사용자 친화적 인터페이스

### 6. 한글 인코딩 문제 해결 ✅

**문제:**
- Windows 배치 파일에서 한글 텍스트 깨짐 현상

**해결 방법:**
- UTF-8 코드페이지 설정: `chcp 65001 >nul 2>&1`
- 영어 기반 인터페이스로 전환
- 필수 한글 메시지만 안전한 방식으로 처리

### 7. 배치 파일 오류 처리 개선 ✅

**해결된 문제들:**

#### **ERRORLEVEL 처리 문제**
- 배치 파일에서 WiX 빌드 성공을 실패로 오인
- 파일 존재 여부 기반 검증으로 변경

#### **콘솔 색상 복원**
- `color 0E` 설정 후 원래 색상으로 복원하지 않는 문제
- 모든 종료 지점에 `color` 명령으로 기본 색상 복원

#### **중복 실행 방지**
- `00_BuildAll.bat`에서 MSI가 두 번 빌드되는 문제
- 매개변수 기반 모드 분리로 해결

### 8. Framework-dependent 배포 최적화 ✅

**배포 결과:**
- **파일 크기**: 7.84MB (CreateNewFile.exe)
- **설치 관리자**: 2.65MB (CreateNewFileSetup.msi)
- **크기 절약**: Self-contained 대비 약 96% 절약
- **요구사항**: .NET 8 Desktop Runtime (자동 체크)

---

## 📁 생성된 파일 구조

```
CreateNewFile/
├── src/
│   ├── CreateNewFile/                 # 메인 애플리케이션
│   │   ├── CreateNewFile.sln         # Visual Studio 솔루션 (WiX 제외)
│   │   └── ... (기존 소스 코드)
│   └── CreateNewFile.Installer/       # 설치 관리자 (독립)
│       ├── 00_BuildAll.bat           # 전체 자동 빌드
│       ├── 01_UpdateFromProject.bat   # 프로젝트 업데이트
│       ├── 02_BuildInstaller.bat     # MSI 생성
│       ├── Package.wxs               # WiX 패키지 정의
│       ├── 1042.wxl                  # 한국어 리소스
│       ├── CreateNewFileSetup.msi    # 최종 설치 파일
│       └── ... (기타 WiX 관련 파일)
├── Documents/
│   ├── 20250825_1425_CNF_Work_list.md    # 이번 세션 작업 내역
│   └── 20250825_1328_CNF_Work_list_total.md  # 전체 프로젝트 히스토리
├── VISUAL_STUDIO_SOLUTION_GUIDE.md   # Visual Studio 사용 가이드
├── INSTALLER_USAGE.md                # 설치 관리자 사용법
└── VISUAL_STUDIO_GUIDE.md           # Visual Studio 개발 가이드
```

---

## 🚀 사용법

### Visual Studio 개발
```
CreateNewFile.sln 열기 → 정상 개발 → F5 디버깅/빌드
```

### 설치 관리자 빌드
```cmd
# 가장 간단한 방법
00_BuildAll.bat

# 또는 단계별
01_UpdateFromProject.bat  # 프로젝트 업데이트
02_BuildInstaller.bat     # MSI 생성
```

---

## 🎯 최종 성과

### ✅ **완전히 해결된 문제들**
1. **Visual Studio 호환성**: WiX 프로젝트 분리로 정상 작동
2. **설치 관리자 자동화**: 3개 배치 파일로 완전 자동화
3. **한글 인코딩 문제**: UTF-8 처리로 해결
4. **배치 파일 오류**: ERRORLEVEL, 색상 복원, 중복 실행 모두 해결
5. **.NET 런타임 관리**: 자동 체크 및 설치 가이드 완성

### 📊 **성능 지표**
- **개발 환경**: Visual Studio 완전 정상화
- **빌드 자동화**: 3-단계 자동 스크립트 완성
- **배포 최적화**: 96% 파일 크기 절약 달성
- **사용자 경험**: 한국어 UI 및 자동 런타임 관리

### 🎉 **배포 준비 상태**
- ✅ **CreateNewFileSetup.msi** (2.65MB) 배포 준비 완료
- ✅ **자동 .NET 8 런타임 체크** 기능 탑재
- ✅ **사용자 친화적 설치 과정** 구현
- ✅ **완전 자동화된 빌드 환경** 구축

---

## 💡 향후 개선 사항

1. **WiX v6 Visual Studio 지원**: 향후 공식 지원 시 통합 고려
2. **설치 관리자 UI**: 커스텀 설치 UI 개발 고려
3. **자동 업데이트**: 앱 내 업데이트 체크 기능 추가 고려

---

**세션 완료 시각**: 2025-08-25 14:25  
**작업 상태**: 모든 목표 달성, 배포 준비 완료 ✅  
**다음 단계**: CreateNewFileSetup.msi 배포 및 사용자 피드백 수집